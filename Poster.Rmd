---
title: "Poster Propsal"
output: html_document
date: '2022-03-24'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidycensus)
library(plotly)
library(ggplot2)
library(dplyr)
library(data.table)
```

Install API Key. Do not run on restart. 

```{r}
census_api_key("93c55c5b22c0fa710c2a4bc6f82751ff6a79dbeb")
```

##Sources
https://github.com/walkerke/umich-workshop

https://censusreporter.org/

Get 2010 Census population by state

```{r}

pop10 <- get_decennial(geography = "state", variables = "P001001")

pop10 <- rename(pop10, "pop_2010" = "value")
```

Get 2020 Census population by state
```{r}

pop20 <- get_decennial(geography = "state", variables = "P1_001N", year = "2020")

pop20 <- rename(pop20, "pop_2020" = "value")
```
Combine data sets

```{r}
pop20_num <- pop20 %>% select(`pop_2020`)
All_pop <- pop10 %>% add_column(pop20_num)

All_pop_percent <- All_pop %>% mutate(increase_decrease = ((pop_2020- pop_2010)/pop_2010)*100) %>% select(NAME, variable, increase_decrease)
```

Percent AZ race - potentially use this method to compare percentage of increase/decrease in state population from 2010/2020
```{r}
v20 <- load_variables(2020, "acs5", cache = TRUE)
Race20 <- v20 %>% filter(concept == 'RACE')

v20_1 <- v20 %>% filter(label %like% 'Hispanic')
v20_2 <- v20 %>% filter(name %like% 'B03002')
v2010
#race_vars <- c(White = "B03002_003", Black = "B003002_004", Native = "B003002_005", Asian = "B003002_006", HIPI = "B003002_007", Hispanic = "B002003_012")

race_vars_20 <- c(White = "B02001_002", Black = "B02001_003", Native = "B02001_004", Asian = "B02001_005", HIPI = "B02001_006", Other= "B02001_007")

HI_race_14 <- get_acs(
geography = "county",
state = "HI",
year = 2014,
variables = race_vars_20
#summary_var = "B03002_001"
)
HI_race_14$yr = 2014

HI_race_19 <- get_acs(
geography = "county",
state = "HI",
year = 2019,
variables = race_vars_20
#summary_var = "B03002_001"
)
HI_race_19$yr = 2019

HI_race_dif = rbind(HI_race_19,HI_race_14)
HI_race_dif_grp <- HI_race_dif %>% group_by(variable, yr) %>% summarize(sum_est = sum(estimate)) %>% arrange(yr, desc=FALSE)

ggplot(data=HI_race_dif_grp, aes(x=factor(yr), y=sum_est, fill=variable)) +
   geom_bar(stat="identity")


#create new dataset for tableau

race_14 <- get_acs(
geography = "county",
state = c("HI","CT","GA","DC"),
year = 2014,
variables = race_vars_20
#summary_var = "B03002_001"
)
race_14$yr = 2014

race_19 <- get_acs(
geography = "county",
state = c("HI","CT","GA","DC"),
year = 2019,
variables = race_vars_20
#summary_var = "B03002_001"
)
race_19$yr = 2019

race_dif = rbind(race_19,race_14)
race_dif_grp <- race_dif %>% group_by(variable, yr, NAME) %>% summarize(sum_est = sum(estimate)) %>% arrange(yr, desc=FALSE)
race_dif_grp <- race_dif_grp %>% rowwise() %>% mutate(st = trimws(strsplit(NAME,',',fixed=TRUE)[[1]][2]))

cap <- read_csv('state_capitals.csv')
cap <- cap %>% select("Abr.","State")

cap[nrow(cap) + 1,] <- as.list(c("DC", "District of Columbia"))
race_dif_grp <- merge(x=race_dif_grp, y=cap, by.x=c("st"), by.y=c("State"), all.x=TRUE) 

write.csv(race_dif_grp, "race_dif_grp.csv")
```
